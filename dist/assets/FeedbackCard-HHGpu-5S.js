import{r as c,j as e,q as v,s as C,h as j,t as U,v as A,w as k,x as w,y as f,z as S,A as m,g as b,B as O,C as M,D as N,E as P,F as _}from"./index-BcDu7jdl.js";import{a as $,b as q,e as G}from"./index-BGDHnJBc.js";const T=[{value:"bug",label:"Bug反馈",description:"Bug 反馈"},{value:"feature",label:"新功能",description:"希望新增什么功能"},{value:"suggestion",label:"建议",description:"对产品的建议便于改良"}];function H(n){var t;return((t=T.find(l=>l.value===n))==null?void 0:t.label)||n}const J=({onSubmit:n,onClose:h})=>{const[t,l]=c.useState("bug"),[i,y]=c.useState(""),[r,g]=c.useState([]),[d,I]=c.useState(!1),[F,o]=c.useState(!1),[R,x]=c.useState(""),B=s=>{const a=s.target.files;if(a){if(r.length+a.length>5){x("图片最多5张"),o(!0);return}Array.from(a).forEach(p=>{if(p.size>5*1024*1024){x("图片大小不能超过5MB"),o(!0);return}const u=new FileReader;u.onload=()=>{g(D=>[...D,p])},u.readAsDataURL(p)}),s.target.value=""}},E=s=>{g(a=>a.filter((p,u)=>u!==s))},z=async()=>{if(!i.trim()){x("请输入反馈内容"),o(!0);return}I(!0);try{await n(i.trim(),t,r),x("反馈成功"),o(!0),l("bug"),y(""),g([])}catch(s){x("反馈失败"),o(!0)}finally{I(!1)}},L=t&&i.trim()&&!d;return e.jsxs("div",{className:"feedback-form",children:[e.jsx(v,{children:e.jsxs(C,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsx(j,{children:e.jsx("strong",{children:"反馈类型"})}),e.jsx(U,{style:{width:"auto"},interface:"action-sheet",placeholder:"请选择反馈类型",value:t,onIonChange:s=>l(s.detail.value),children:T.map(s=>e.jsx(A,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx(j,{children:e.jsxs("strong",{children:["图片 (",r.length,"/5)"]})}),e.jsx(k,{style:{marginTop:"6px"},children:e.jsxs(w,{children:[r.map((s,a)=>e.jsx(f,{size:"4",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(S,{src:URL.createObjectURL(s),alt:"图片 ".concat(a+1),style:{width:"100%",height:"100px",objectFit:"cover",borderRadius:"8px"}}),e.jsx(m,{fill:"clear",size:"small",style:{position:"absolute",top:"4px",right:"4px","--border-radius":"50%","--background":"rgba(0,0,0,0.6)",width:"32px",height:"32px"},onClick:()=>E(a),children:e.jsx(b,{icon:$,style:{color:"white"}})})]})},a)),r.length<5&&e.jsx(f,{size:"4",children:e.jsx("div",{onClick:()=>{var s;return(s=document.getElementById("image-upload"))==null?void 0:s.click()},style:{width:"100%",height:"100px",border:"2px dashed #ccc",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:"#f8f9fa"},children:e.jsx(b,{icon:q,style:{fontSize:"32px",color:"#999"}})})})]})})]}),e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsx(j,{children:e.jsx("strong",{children:"反馈内容"})}),e.jsx(O,{placeholder:"请输入反馈内容",value:i,onIonInput:s=>y(s.detail.value),rows:3,maxlength:500,counter:!0,fill:"outline"})]}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:B,style:{display:"none"},id:"image-upload",disabled:r.length>=5}),e.jsxs("div",{style:{marginTop:"5px",display:"flex",gap:"10px"},children:[e.jsx(m,{expand:"block",onClick:h,disabled:d,fill:"outline",children:"关闭"}),e.jsx(m,{expand:"block",onClick:z,disabled:!L||d,fill:d?"outline":"solid",style:{flex:1},children:d?e.jsx(M,{type:"indeterminate",style:{marginRight:"8px"}}):e.jsxs(e.Fragment,{children:[e.jsx(b,{icon:G,slot:"start"}),"提交"]})})]})]})}),e.jsx(N,{isOpen:F,onDidDismiss:()=>o(!1),message:R,duration:3e3,position:"top"})]})},Q=({type:n,description:h,images:t})=>e.jsx("div",{className:"feedback-form",children:e.jsxs(v,{color:"warning",children:[e.jsx(P,{children:e.jsx(_,{children:H(n)})}),e.jsxs(C,{children:[t&&t.length>0&&e.jsx("div",{style:{marginBottom:"10px"},children:e.jsx(k,{style:{marginTop:"6px"},children:e.jsx(w,{children:t.map((l,i)=>e.jsx(f,{size:"4",children:e.jsx("div",{style:{position:"relative"},children:e.jsx(S,{src:URL.createObjectURL(l),alt:"图片 ".concat(i+1),style:{width:"100%",height:"100px",objectFit:"cover",borderRadius:"8px"}})})},i))})})}),e.jsx("div",{style:{marginTop:"10px"},children:h})]})]})});export{J as F,Q as a};
