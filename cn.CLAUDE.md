# 开发指南

## 理念

### 核心信念

- **渐进式进展而非大爆炸式改动** - 能够编译通过测试的小改动
- **从现有代码中学习** - 先研究和规划再实施
- **务实而非教条** - 适应项目现实
- **清晰意图而非巧妙代码** - 保持无聊和显而易见

### 简洁性意味着

- 每个函数/类单一职责
- 避免过早抽象
- 没有巧妙技巧 - 选择无聊的解决方案
- 如果你需要解释它，那就太复杂了

## 流程

### 1. 规划和分阶段

将复杂工作分解为3-5个阶段。在 `IMPLEMENTATION_PLAN.md` 中记录：

```markdown
## 阶段 N: [名称]
**目标**: [具体可交付成果]
**成功标准**: [可测试的结果]
**测试**: [具体测试用例]
**状态**: [未开始|进行中|完成]
```
- 随着进展更新状态
- 所有阶段完成后删除文件

### 2. 实施流程

1. **理解** - 研究代码库中现有模式
2. **测试** - 先写测试（红色）
3. **实施** - 通过测试的最少代码（绿色）
4. **重构** - 在测试通过的情况下清理代码
5. **提交** - 带有清晰消息链接到计划

### 3. 遇到困难时（3次尝试后）

**关键**: 每个问题最多尝试3次，然后停止。

1. **记录失败内容**:
   - 你尝试了什么
   - 具体错误消息
   - 你认为失败的原因

2. **研究替代方案**:
   - 找到2-3个类似实现
   - 注意使用的不同方法

3. **质疑基础**:
   - 这是正确的抽象级别吗？
   - 能否拆分成更小的问题？
   - 是否存在完全更简单的方法？

4. **尝试不同角度**:
   - 不同的库/框架特性？
   - 不同的架构模式？
   - 移除而非添加抽象？

## 技术标准

### 架构原则

- **组合优于继承** - 使用依赖注入
- **接口优于单例** - 启用测试和灵活性
- **显式优于隐式** - 清晰的数据流和依赖关系
- **尽可能测试驱动** - 永远不要禁用测试，而是修复它们

### 代码质量

- **每次提交必须**:
  - 编译成功
  - 通过所有现有测试
  - 包含新功能的测试
  - 遵循项目格式化/代码检查

- **提交前**:
  - 运行格式化器/代码检查工具
  - 自我审查更改
  - 确保提交消息解释"为什么"

### 错误处理

- 快速失败并提供描述性消息
- 包含调试上下文
- 在适当级别处理错误
- 永远不要静默吞咽异常

## 决策框架

当存在多个有效方法时，基于以下因素选择：

1. **可测试性** - 我能轻松测试这个吗？
2. **可读性** - 6个月后有人会理解这个吗？
3. **一致性** - 这符合项目模式吗？
4. **简洁性** - 这是有效的最简单解决方案吗？
5. **可逆性** - 以后更改有多困难？

## 项目集成

### 学习代码库

- 找到3个类似的特性/组件
- 识别通用模式和约定
- 尽可能使用相同的库/工具
- 遵循现有测试模式

### 工具

- 使用项目现有的构建系统
- 使用项目的测试框架
- 使用项目的格式化器/代码检查设置
- 没有强有力的理由不要引入新工具

## 质量关卡

### 完成定义

- [ ] 测试编写并通过
- [ ] 代码遵循项目约定
- [ ] 没有代码检查器/格式化器警告
- [ ] 提交消息清晰
- [ ] 实施匹配计划
- [ ] 没有未带问题编号的TODO

### 测试指南

- 测试行为，而非实现
- 尽可能每个测试一个断言
- 描述场景的清晰测试名称
- 使用现有的测试工具/助手
- 测试应该是确定性的

## 重要提醒

**永远不要**:
- 使用 `--no-verify` 绕过提交钩子
- 禁用测试而不是修复它们
- 提交不能编译的代码
- 做假设 - 用现有代码验证

**始终**:
- 增量提交工作代码
- 随着进展更新计划文档
- 从现有实现中学习
- 3次失败尝试后停止并重新评估